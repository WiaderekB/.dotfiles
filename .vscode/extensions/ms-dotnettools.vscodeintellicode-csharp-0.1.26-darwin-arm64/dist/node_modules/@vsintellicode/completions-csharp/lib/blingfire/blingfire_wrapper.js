"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.WordHyphenation=exports.TextToIds=exports.FreeModel=exports.LoadModel=exports.LoadLocalModel=exports.TextToSentences=exports.TextToWords=exports.GetVersion=void 0;const blingfire_js_1=require("./blingfire.js"),fs_1=require("fs");function GetVersion(){return blingfire_js_1.Module._GetBlingFireTokVersion()}function TextToWords(e){var r=blingfire_js_1.Module.lengthBytesUTF8(e),o=blingfire_js_1.Module._malloc(r+1);blingfire_js_1.Module.stringToUTF8(e,o,r+1);var l=1+(r<<1),i=blingfire_js_1.Module._malloc(l);try{var n=blingfire_js_1.Module._TextToWords(o,r,i,l);if(0>n||n>l)return null}finally{0!=o&&blingfire_js_1.Module._free(o),0!=i&&blingfire_js_1.Module._free(i)}return blingfire_js_1.Module.UTF8ToString(i)}function TextToSentences(e){var r=blingfire_js_1.Module.lengthBytesUTF8(e),o=blingfire_js_1.Module._malloc(r+1);blingfire_js_1.Module.stringToUTF8(e,o,r+1);var l=1+(r<<1),i=blingfire_js_1.Module._malloc(l);try{var n=blingfire_js_1.Module._TextToSentences(o,r,i,l);if(0>n||n>l)return null}finally{0!=o&&blingfire_js_1.Module._free(o),0!=i&&blingfire_js_1.Module._free(i)}return blingfire_js_1.Module.UTF8ToString(i)}async function LoadLocalModel(e){var r=0;try{var o=await fs_1.promises.readFile(e);const l=new Uint8Array(o);for(;!blingfire_js_1.Module.asm;)await new Promise((e=>setTimeout(e,500)));return r=blingfire_js_1.Module._malloc(o.byteLength),blingfire_js_1.Module.HEAPU8.set(l,r),{h:blingfire_js_1.Module._SetModel(r,o.byteLength),wasmMem:r}}catch(o){throw 0!=r&&blingfire_js_1.Module._free(r),new Error(`Error loading model: ${e}\n${o}`)}}async function LoadModel(e){var r=0;try{const l=await fetch(e);var o=await l.arrayBuffer();const i=new Uint8Array(o);return r=blingfire_js_1.Module._malloc(o.byteLength),blingfire_js_1.Module.HEAPU8.set(i,r),{h:blingfire_js_1.Module._SetModel(r,o.byteLength),wasmMem:r}}catch(o){return console.error("Error loading model: "+e),0!=r&&blingfire_js_1.Module._free(r),null}}function FreeModel(e){if(null!=e){var{h:r,wasmMem:o}=e;0!=r&&blingfire_js_1.Module._FreeModel(r),0!=o&&blingfire_js_1.Module._free(o)}}function TextToIds(e,r,o,l=0){if(null!=e){var{h:i,wasmMem:n}=e,_=blingfire_js_1.Module.lengthBytesUTF8(r),t=blingfire_js_1.Module._malloc(_+1);blingfire_js_1.Module.stringToUTF8(r,t,_+1);var s=o,d=blingfire_js_1.Module._malloc(4*s);try{var f=blingfire_js_1.Module._TextToIds(i,t,_,d,s,l);if(0>=f)return null;for(var u=f<s?f:s,a=blingfire_js_1.Module.HEAPU8.subarray(d,d+4*u),M=new Int32Array(u),g=0,b=0;g<u;g++,b+=4)M[g]=a[b]+256*a[b+1]+65536*a[b+2]+16777216*a[b+3]}finally{0!=t&&blingfire_js_1.Module._free(t),0!=d&&blingfire_js_1.Module._free(d)}return M}}function WordHyphenation(e,r,o=45){if(null!=e){var{h:l,wasmMem:i}=e,n=blingfire_js_1.Module.lengthBytesUTF8(r),_=blingfire_js_1.Module._malloc(n+1);blingfire_js_1.Module.stringToUTF8(r,_,n+1);var t=1+(n<<1),s=blingfire_js_1.Module._malloc(t);try{var d=blingfire_js_1.Module._WordHyphenationWithModel(_,n,s,t,l,o);if(0>d||d>t)return null}finally{0!=_&&blingfire_js_1.Module._free(_),0!=s&&blingfire_js_1.Module._free(s)}return blingfire_js_1.Module.UTF8ToString(s)}}exports.GetVersion=GetVersion,exports.TextToWords=TextToWords,exports.TextToSentences=TextToSentences,exports.LoadLocalModel=LoadLocalModel,exports.LoadModel=LoadModel,exports.FreeModel=FreeModel,exports.TextToIds=TextToIds,exports.WordHyphenation=WordHyphenation;